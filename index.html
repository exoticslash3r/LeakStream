<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeakStream - Video Platform</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; min-height: 100vh; }
        
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; background: linear-gradient(90deg, #1a1a1a 0%, #2a0a0a 100%); 
            padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; z-index: 1000;
            border-bottom: 3px solid transparent; box-shadow: 0 0 25px rgba(255, 0, 0, 0.7); animation: wiggle 3s infinite, glow 2s infinite alternate;
        }
        @keyframes wiggle { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes glow { from { box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); } to { box-shadow: 0 0 35px rgba(255, 0, 0, 0.9); } }
        .navbar::before {
            content: ''; position: absolute; bottom: -3px; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, transparent 0%, #ff0000 20%, #ff0000 80%, transparent 100%); animation: line-glow 2s infinite alternate;
        }
        @keyframes line-glow { from { opacity: 0.7; } to { opacity: 1; } }
        
        .logo-container { display: flex; align-items: center; gap: 20px; }
        .spinning-logo { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #ff0000; 
            animation: spin 3s linear infinite; box-shadow: 0 0 15px rgba(255, 0, 0, 0.6); object-fit: cover; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .site-title { font-size: 28px; font-weight: bold; background: linear-gradient(45deg, #ff0000, #ff6b6b); 
            -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 10px rgba(255, 0, 0, 0.3); letter-spacing: 1.5px; }
        
        .nav-buttons { display: flex; gap: 15px; }
        .nav-btn, .code-btn { padding: 10px 25px; background: linear-gradient(45deg, #ff0000, #cc0000); color: white; 
            border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; 
            text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3); }
        .nav-btn:hover, .code-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 0, 0, 0.5); }
        .code-btn.admin-active { background: linear-gradient(45deg, #00cc00, #009900); box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
        
        .main-content { margin-top: 100px; padding: 30px; min-height: calc(100vh - 100px); }
        
        .videos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 20px 0; }
        .video-card { background: #1a1a1a; border-radius: 15px; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; 
            border: 1px solid #333; position: relative; }
        .video-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(255, 0, 0, 0.2); border-color: #ff0000; }
        .video-player { width: 100%; height: 200px; background: #000; }
        .video-player video { width: 100%; height: 100%; object-fit: contain; }
        .video-info { padding: 20px; }
        .video-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #fff; word-break: break-word; }
        .video-meta { font-size: 12px; color: #aaa; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { position: absolute; top: 15px; right: 15px; background: rgba(255, 0, 0, 0.9); color: white; border: none; 
            padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; display: none; }
        .video-card:hover .delete-btn { display: block; }
        
        .upload-container { max-width: 600px; margin: 0 auto; background: #1a1a1a; padding: 40px; border-radius: 20px; 
            border: 1px solid #333; box-shadow: 0 10px 30px rgba(255, 0, 0, 0.1); }
        .upload-title { font-size: 32px; text-align: center; margin-bottom: 30px; color: #fff; text-transform: uppercase; letter-spacing: 2px; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 10px; color: #fff; font-weight: bold; font-size: 16px; }
        .form-input { width: 100%; padding: 15px; background: #000; border: 2px solid #333; border-radius: 10px; color: #fff; 
            font-size: 16px; transition: border-color 0.3s ease; }
        .form-input:focus { outline: none; border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.2); }
        .hosting-links { margin-top: 30px; padding: 20px; background: rgba(255, 0, 0, 0.05); border-radius: 10px; border: 1px dashed #ff0000; }
        .hosting-links h3 { color: #ff6b6b; margin-bottom: 10px; font-size: 18px; }
        .hosting-links a { color: #ff6b6b; text-decoration: none; display: block; margin: 8px 0; padding: 8px; border-radius: 5px; transition: background 0.3s; }
        .hosting-links a:hover { background: rgba(255, 0, 0, 0.1); text-decoration: underline; }
        .upload-btn { width: 100%; padding: 18px; background: linear-gradient(45deg, #ff0000, #cc0000); color: white; border: none; 
            border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; 
            text-transform: uppercase; letter-spacing: 1.5px; margin-top: 20px; box-shadow: 0 6px 20px rgba(255, 0, 0, 0.3); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); 
            display: flex; align-items: center; justify-content: center; z-index: 2000; display: none; }
        .modal-content { background: #1a1a1a; padding: 40px; border-radius: 20px; border: 2px solid #ff0000; 
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.5); max-width: 500px; width: 90%; }
        .modal-title { font-size: 24px; margin-bottom: 20px; color: #fff; text-align: center; }
        .code-input { width: 100%; padding: 15px; font-size: 18px; letter-spacing: 3px; text-align: center; 
            background: #000; border: 2px solid #ff0000; color: #fff; border-radius: 10px; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 15px; }
        .modal-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .modal-btn.submit { background: linear-gradient(45deg, #ff0000, #cc0000); color: white; }
        .modal-btn.cancel { background: #333; color: #aaa; }
        
        .message { padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; display: none; }
        .message.success { background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; color: #00ff00; display: block; }
        .message.error { background: rgba(255, 0, 0, 0.1); border: 1px solid #ff0000; color: #ff0000; display: block; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .loading { text-align: center; margin: 20px 0; display: none; }
        .loading-spinner { border: 3px solid #333; border-top: 3px solid #ff0000; border-radius: 50%; 
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        
        .admin-panel { background: rgba(0, 100, 0, 0.2); border: 1px solid #00ff00; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        
        .firebase-error { background: rgba(255, 0, 0, 0.1); border: 2px solid #ff0000; padding: 20px; border-radius: 10px; 
            margin: 20px auto; max-width: 600px; text-align: center; }
        .firebase-error h3 { color: #ff0000; margin-bottom: 15px; }
        .firebase-error ol { text-align: left; margin: 20px 0; padding-left: 20px; }
        .firebase-error li { margin-bottom: 10px; }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo-container">
            <img src="https://i.pinimg.com/736x/d2/ba/23/d2ba23dc373c9ca95a1231c785222e80.jpg" alt="LeakStream Logo" class="spinning-logo">
            <div class="site-title">LEAKSTREAM</div>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showHomePage()">Home</button>
            <button class="nav-btn" onclick="showUploadPage()">Post</button>
            <button class="code-btn" id="codeBtn" onclick="showCodeModal()">Code</button>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <div id="firebaseError" style="display: none;">
            <!-- Firebase error will be displayed here -->
        </div>
        <!-- Normal content will be loaded here -->
    </div>

    <!-- Code Modal -->
    <div class="modal-overlay" id="codeModal">
        <div class="modal-content">
            <h2 class="modal-title">Enter Admin Code</h2>
            <input type="password" class="code-input" id="adminCode" placeholder="Enter secret code" maxlength="20">
            <div class="modal-buttons">
                <button class="modal-btn submit" onclick="checkAdminCode()">Submit</button>
                <button class="modal-btn cancel" onclick="hideCodeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Templates -->
    <template id="homeTemplate">
        <div id="adminPanel" class="admin-panel" style="display: none;">
            <div class="admin-status">üîì ADMIN MODE ACTIVE - You can delete posts</div>
            <button class="nav-btn" onclick="exitAdminMode()" style="padding: 8px 20px; font-size: 14px;">Exit Admin Mode</button>
        </div>
        <div class="loading" id="loadingVideos">
            <div class="loading-spinner"></div>
            <p>Loading videos...</p>
        </div>
        <div class="videos-grid" id="videosGrid"></div>
        <div class="empty-state" id="emptyState">
            <div style="font-size: 64px; margin-bottom: 20px;">üìπ</div>
            <h2>No Videos Yet</h2>
            <p>Be the first to post a video link!</p>
        </div>
    </template>

    <template id="uploadTemplate">
        <div class="upload-container">
            <h1 class="upload-title">Post Video Link</h1>
            <div class="message" id="message"></div>
            <div class="form-group">
                <label for="videoTitle">Video Title *</label>
                <input type="text" id="videoTitle" class="form-input" placeholder="Enter video title" maxlength="100" required>
            </div>
            <div class="form-group">
                <label for="videoUrl">MP4 Video URL *</label>
                <input type="url" id="videoUrl" class="form-input" placeholder="https://example.com/video.mp4" required>
            </div>
            <div class="hosting-links">
                <h3>üìπ Some Free Video Hosters:</h3>
                <a href="https://www.screenapp.io/features/share-video" target="_blank">‚Ä¢ ScreenApp - Share your Videos</a>
                <a href="https://imagekit.io/dashboard" target="_blank">‚Ä¢ ImageKit.io - Image & Video CDN</a>
            </div>
            <button class="upload-btn" id="uploadBtn" onclick="postVideoLink()">üì§ Publish Video Link</button>
        </div>
    </template>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAyTSyWhLVe22jynP94cp9OEg6IC5-OhdE",
            authDomain: "leakstream-4f62f.firebaseapp.com",
            projectId: "leakstream-4f62f",
            storageBucket: "leakstream-4f62f.firebasestorage.app",
            messagingSenderId: "886997714546",
            appId: "1:886997714546:web:b7fcbb9b28010d5ec564eb",
            measurementId: "G-RXHE019ZWT"
        };

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let app;
        let db;
        let currentPage = 'home';
        let isAdmin = false;
        const ADMIN_CODE = "UNDESCRIMINATED-2012";
        let isFirebaseInitialized = false;

        // ============================================
        // INITIALIZE FIREBASE
        // ============================================
        function initializeFirebase() {
            console.log("Initializing Firebase...");
            
            try {
                // Check if Firebase SDK is loaded
                if (typeof firebase === 'undefined') {
                    throw new Error("Firebase SDK not loaded. Check internet connection.");
                }
                
                // Initialize Firebase
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                isFirebaseInitialized = true;
                
                console.log("‚úÖ Firebase initialized successfully!");
                hideFirebaseError();
                return true;
                
            } catch (error) {
                console.error("‚ùå Firebase initialization failed:", error);
                
                // Show detailed error to user
                let errorMessage = error.message || "Unknown error";
                
                if (errorMessage.includes("already exists")) {
                    // Firebase already initialized (this is okay)
                    app = firebase.app();
                    db = firebase.firestore();
                    isFirebaseInitialized = true;
                    console.log("‚úÖ Firebase already initialized, using existing app");
                    hideFirebaseError();
                    return true;
                } else if (errorMessage.includes("permission")) {
                    showFirebaseError(
                        "Firebase Permission Error",
                        "Your Firebase project may not have Firestore enabled or permissions set correctly.",
                        [
                            "Go to Firebase Console",
                            "Select your project: 'leakstream-4f62f'",
                            "Enable Firestore Database",
                            "Set security rules to allow public access"
                        ]
                    );
                } else if (errorMessage.includes("API key")) {
                    showFirebaseError(
                        "Invalid Firebase Configuration",
                        "There's an issue with your Firebase API key or configuration.",
                        [
                            "Check if your Firebase project exists",
                            "Verify the API key in your Firebase project settings",
                            "Make sure Firestore is enabled",
                            "Check browser console for detailed errors"
                        ]
                    );
                } else {
                    showFirebaseError(
                        "Firebase Connection Failed",
                        errorMessage,
                        [
                            "Check your internet connection",
                            "Make sure Firebase services are enabled",
                            "Check browser console for errors (F12)",
                            "Try refreshing the page"
                        ]
                    );
                }
                return false;
            }
        }

        // ============================================
        // ERROR HANDLING UI
        // ============================================
        function showFirebaseError(title, message, steps) {
            const errorDiv = document.getElementById('firebaseError');
            if (!errorDiv) return;
            
            let stepsHtml = '';
            if (steps && steps.length > 0) {
                stepsHtml = '<ol>';
                steps.forEach(step => {
                    stepsHtml += `<li>${step}</li>`;
                });
                stepsHtml += '</ol>';
            }
            
            errorDiv.innerHTML = `
                <div class="firebase-error">
                    <h3>‚ö†Ô∏è ${title}</h3>
                    <p>${message}</p>
                    ${stepsHtml}
                    <div style="margin-top: 20px;">
                        <button class="nav-btn" onclick="retryFirebaseInit()" style="margin: 5px;">
                            üîÑ Retry Connection
                        </button>
                        <button class="nav-btn" onclick="showManualSetup()" style="margin: 5px; background: #333;">
                            üìã Setup Instructions
                        </button>
                    </div>
                </div>
            `;
            errorDiv.style.display = 'block';
            
            // Hide normal content
            const mainContent = document.getElementById('mainContent');
            Array.from(mainContent.children).forEach(child => {
                if (child.id !== 'firebaseError') {
                    child.style.display = 'none';
                }
            });
        }

        function hideFirebaseError() {
            const errorDiv = document.getElementById('firebaseError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
            // Show all other content
            const mainContent = document.getElementById('mainContent');
            Array.from(mainContent.children).forEach(child => {
                child.style.display = 'block';
            });
        }

        function retryFirebaseInit() {
            if (initializeFirebase()) {
                initApp();
            }
        }

        function showManualSetup() {
            const errorDiv = document.getElementById('firebaseError');
            if (!errorDiv) return;
            
            errorDiv.innerHTML = `
                <div class="firebase-error">
                    <h3>üìã Firebase Setup Instructions</h3>
                    <p>Follow these steps to set up Firebase:</p>
                    <ol>
                        <li>Go to <a href="https://console.firebase.google.com/" target="_blank" style="color: #ff6b6b;">Firebase Console</a></li>
                        <li>Select or create project "leakstream-4f62f"</li>
                        <li>Click "Firestore Database" in the left menu</li>
                        <li>Click "Create Database" ‚Üí Start in test mode</li>
                        <li>Go to "Rules" tab and paste:</li>
                    </ol>
                    <div style="background: #000; padding: 15px; border-radius: 5px; margin: 15px 0; font-family: monospace; font-size: 12px;">
                        rules_version = '2';<br>
                        service cloud.firestore {<br>
                        &nbsp;&nbsp;match /databases/{database}/documents {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;match /videos/{videoId} {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow read: if true;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow create: if true;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow delete: if true;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                    <li>Click "Publish"</li>
                    <li>Refresh this page</li>
                    </ol>
                    <button class="nav-btn" onclick="retryFirebaseInit()" style="margin-top: 20px;">
                        üîÑ I've Set Up Firebase - Retry
                    </button>
                </div>
            `;
        }

        // ============================================
        // APP INITIALIZATION
        // ============================================
        function initApp() {
            console.log("Initializing LeakStream app...");
            
            if (!isFirebaseInitialized) {
                console.log("Firebase not initialized, attempting to initialize...");
                if (!initializeFirebase()) {
                    return; // Error already shown
                }
            }
            
            showHomePage();
            checkAdminStatus();
            console.log("‚úÖ App initialized successfully!");
        }

        // ============================================
        // PAGE MANAGEMENT
        // ============================================
        function showHomePage() {
            if (!isFirebaseInitialized) {
                showFirebaseError(
                    "Firebase Not Connected",
                    "Cannot load videos without Firebase connection.",
                    ["Click 'Retry Connection' or check setup instructions"]
                );
                return;
            }
            
            currentPage = 'home';
            const mainContent = document.getElementById('mainContent');
            const homeTemplate = document.getElementById('homeTemplate');
            
            if (mainContent && homeTemplate) {
                // Hide any Firebase error
                hideFirebaseError();
                
                // Set content
                mainContent.innerHTML = '';
                mainContent.appendChild(homeTemplate.content.cloneNode(true));
                loadVideos();
                updateAdminPanel();
            }
        }

        function showUploadPage() {
            if (!isFirebaseInitialized) {
                showFirebaseError(
                    "Firebase Not Connected",
                    "Cannot upload videos without Firebase connection.",
                    ["Click 'Retry Connection' or check setup instructions"]
                );
                return;
            }
            
            currentPage = 'upload';
            const mainContent = document.getElementById('mainContent');
            const uploadTemplate = document.getElementById('uploadTemplate');
            
            if (mainContent && uploadTemplate) {
                // Hide any Firebase error
                hideFirebaseError();
                
                // Set content
                mainContent.innerHTML = '';
                mainContent.appendChild(uploadTemplate.content.cloneNode(true));
            }
        }

        // ============================================
        // VIDEO MANAGEMENT
        // ============================================
        async function loadVideos() {
            if (!db) {
                console.error("Firestore not available");
                return;
            }
            
            const videosGrid = document.getElementById('videosGrid');
            const emptyState = document.getElementById('emptyState');
            const loadingElement = document.getElementById('loadingVideos');
            
            if (!videosGrid) return;
            
            try {
                if (loadingElement) loadingElement.style.display = 'block';
                if (emptyState) emptyState.style.display = 'none';
                videosGrid.innerHTML = '';
                
                const snapshot = await db.collection('videos')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                if (loadingElement) loadingElement.style.display = 'none';
                
                if (snapshot.empty) {
                    if (emptyState) emptyState.style.display = 'block';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const video = { id: doc.id, ...doc.data() };
                    const videoCard = createVideoCard(video);
                    videosGrid.appendChild(videoCard);
                });
                
            } catch (error) {
                console.error('Error loading videos:', error);
                if (loadingElement) loadingElement.style.display = 'none';
                
                // Show error in grid
                videosGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <p style="color: #ff4444; font-size: 18px;">Error loading videos</p>
                        <p style="color: #aaa; font-size: 14px;">${error.message}</p>
                        <button class="nav-btn" onclick="loadVideos()" style="margin-top: 15px;">
                            üîÑ Retry
                        </button>
                    </div>
                `;
            }
        }

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `video-${video.id}`;
            
            const postDate = video.timestamp?.toDate 
                ? new Date(video.timestamp.toDate()).toLocaleDateString()
                : 'Recent';
            
            // Escape HTML for security
            const safeTitle = escapeHtml(video.title || 'Untitled');
            const safeUrl = escapeHtml(video.videoUrl || '');
            
            card.innerHTML = `
                <div class="video-player">
                    <video controls>
                        <source src="${safeUrl}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="video-info">
                    <h3 class="video-title">${safeTitle}</h3>
                    <div class="video-meta">
                        <span>Posted: ${postDate}</span>
                        <span>MP4 Link</span>
                    </div>
                </div>
                ${isAdmin ? `<button class="delete-btn" onclick="deletePost('${video.id}')">üóë Delete</button>` : ''}
            `;
            
            return card;
        }

        async function postVideoLink() {
            if (!db) {
                showMessage('Firebase not connected', 'error');
                return;
            }
            
            const titleInput = document.getElementById('videoTitle');
            const urlInput = document.getElementById('videoUrl');
            const uploadBtn = document.getElementById('uploadBtn');
            
            const title = titleInput ? titleInput.value.trim() : '';
            const videoUrl = urlInput ? urlInput.value.trim() : '';
            
            if (!title) {
                showMessage('Please enter a video title', 'error');
                return;
            }
            
            if (!videoUrl || !videoUrl.startsWith('http')) {
                showMessage('Please enter a valid URL', 'error');
                return;
            }
            
            // Disable button
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Publishing...';
            
            try {
                await db.collection('videos').add({
                    title: title,
                    videoUrl: videoUrl,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    postedBy: 'Anonymous'
                });
                
                showMessage('‚úÖ Video posted successfully!', 'success');
                
                // Clear form
                if (titleInput) titleInput.value = '';
                if (urlInput) urlInput.value = '';
                
                setTimeout(() => {
                    showHomePage();
                }, 1500);
                
            } catch (error) {
                console.error('Error posting video:', error);
                showMessage(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'üì§ Publish Video Link';
            }
        }

        // ============================================
        // ADMIN SYSTEM
        // ============================================
        function showCodeModal() {
            const modal = document.getElementById('codeModal');
            const codeInput = document.getElementById('adminCode');
            if (modal && codeInput) {
                modal.style.display = 'flex';
                codeInput.value = '';
                codeInput.focus();
            }
        }
        
        function hideCodeModal() {
            const modal = document.getElementById('codeModal');
            if (modal) modal.style.display = 'none';
        }

        function checkAdminCode() {
            const codeInput = document.getElementById('adminCode');
            const enteredCode = codeInput ? codeInput.value.trim() : '';
            
            if (enteredCode === ADMIN_CODE) {
                isAdmin = true;
                localStorage.setItem('leakstream_admin', 'true');
                showMessage('üîì Admin mode activated!', 'success');
                hideCodeModal();
                updateAdminPanel();
                loadVideos();
            } else {
                showMessage('‚ùå Incorrect code', 'error');
                if (codeInput) {
                    codeInput.value = '';
                    codeInput.focus();
                }
            }
        }

        function checkAdminStatus() {
            const savedAdmin = localStorage.getItem('leakstream_admin');
            isAdmin = savedAdmin === 'true';
            updateAdminPanel();
        }

        function updateAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            const codeBtn = document.getElementById('codeBtn');
            
            if (adminPanel) {
                adminPanel.style.display = isAdmin ? 'block' : 'none';
            }
            
            if (codeBtn) {
                if (isAdmin) {
                    codeBtn.classList.add('admin-active');
                    codeBtn.textContent = 'Admin Mode';
                } else {
                    codeBtn.classList.remove('admin-active');
                    codeBtn.textContent = 'Code';
                }
            }
        }

        function exitAdminMode() {
            isAdmin = false;
            localStorage.removeItem('leakstream_admin');
            updateAdminPanel();
            showMessage('Admin mode deactivated', 'error');
            loadVideos();
        }

        async function deletePost(videoId) {
            if (!isAdmin || !db) {
                showMessage('Admin privileges required', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this post?')) {
                return;
            }
            
            try {
                await db.collection('videos').doc(videoId).delete();
                
                const videoElement = document.getElementById(`video-${videoId}`);
                if (videoElement) {
                    videoElement.remove();
                }
                
                showMessage('‚úÖ Post deleted', 'success');
                
            } catch (error) {
                console.error('Error deleting post:', error);
                showMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function showMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.id = 'tempMessage';
            
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.insertBefore(messageDiv, mainContent.firstChild);
                
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // INITIALIZE ON LOAD
        // ============================================
        window.onload = function() {
            console.log("Page loaded, starting initialization...");
            
            // Check if running locally
            if (window.location.protocol === 'file:') {
                console.warn("Running from file:// protocol. Firebase may have issues.");
                showFirebaseError(
                    "Local File Warning",
                    "You're running this from a local file. Some browsers block Firebase from local files.",
                    [
                        "Upload to a web server (GitHub Pages, Netlify, etc.)",
                        "Or use a local server:",
                        "1. Install Node.js",
                        "2. Run: npx serve .",
                        "3. Open http://localhost:3000"
                    ]
                );
            }
            
            // Initialize Firebase and app
            setTimeout(() => {
                if (initializeFirebase()) {
                    initApp();
                }
            }, 500);
        };

        // ============================================
        // DEBUG INFO IN CONSOLE
        // ============================================
        console.log(`
üî• LEAKSTREAM DEBUG INFO üî•
============================
Firebase Config Loaded: ${firebaseConfig.projectId}
Admin Code: ${ADMIN_CODE}
Running from: ${window.location.protocol}
        
FIREBASE SETUP CHECKLIST:
1. Go to: https://console.firebase.google.com/
2. Select project: ${firebaseConfig.projectId}
3. Enable Firestore Database
4. Set these rules in Firestore > Rules:
        
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /videos/{videoId} {
      allow read: if true;
      allow create: if true;
      allow delete: if true;
    }
  }
}
        
5. Click "Publish"
6. Refresh this page
============================
        `);
    </script>
</body>
</html>
