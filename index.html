<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>LeakStream</title>
    <style>
        /* Snow animation */
        .snow {
            position: fixed;
            top: -10px;
            color: white;
            user-select: none;
            pointer-events: none;
            z-index: 1000;
        }
        
        /* Logo overlay */
        .video-logo {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 0 10px red) 
                    drop-shadow(0 0 20px white);
            animation: logo-glow 3s infinite alternate;
            z-index: 10;
        }
        
        @keyframes logo-glow {
            0% { filter: drop-shadow(0 0 10px red); }
            50% { filter: drop-shadow(0 0 20px white); }
            100% { filter: drop-shadow(0 0 15px black); }
        }
        
        /* Search bar */
        .search-container {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            z-index: 100;
        }
        
        #searchInput {
            width: 100%;
            padding: 12px;
            border: 2px solid red;
            border-radius: 25px;
            background: #111;
            color: white;
            font-size: 16px;
        }
        
        /* Spam timeout screen */
        .timeout-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: timeout-glow 2s infinite;
        }
        
        @keyframes timeout-glow {
            0%, 100% { box-shadow: inset 0 0 100px red; }
            50% { box-shadow: inset 0 0 100px white; }
        }
    </style>
</head>
<body>
    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search videos...">
        <div id="searchResults"></div>
    </div>
    
    <!-- Videos Container -->
    <div id="videosContainer"></div>
    
    <!-- Firebase & Main Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "YOUR_NEW_API_KEY_HERE", // ⚠️ REPLACE THIS!
            authDomain: "leakstream-4f62f.firebaseapp.com",
            projectId: "leakstream-4f62f",
            storageBucket: "leakstream-4f62f.firebasestorage.app",
            messagingSenderId: "886997714546",
            appId: "1:886997714546:web:b7fcbb9b28010d5ec564eb",
            measurementId: "G-RXHE019ZWT"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Real-time search
        const searchInput = document.getElementById('searchInput');
        const videosContainer = document.getElementById('videosContainer');
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm.length > 0) {
                const postsRef = collection(db, 'posts');
                const q = query(
                    postsRef,
                    where('keywords', 'array-contains', searchTerm),
                    orderBy('timestamp', 'desc'),
                    limit(50)
                );
                
                onSnapshot(q, (snapshot) => {
                    displayVideos(snapshot);
                });
            }
        });
        
        function displayVideos(snapshot) {
            videosContainer.innerHTML = '';
            
            snapshot.forEach(doc => {
                const post = doc.data();
                const videoElement = createVideoElement(post);
                videosContainer.appendChild(videoElement);
            });
        }
        
        function createVideoElement(post) {
            const div = document.createElement('div');
            div.className = 'video-post';
            div.innerHTML = `
                <div style="position: relative;">
                    <img src="${post.thumbnail}" class="video-thumbnail">
                    <img src="https://i.postimg.cc/W1Jg7yv0/leakstream-removebg-preview.png" 
                         class="video-logo" alt="Logo">
                    <button onclick="downloadVideo('${post.videoUrl}')" 
                            style="position: absolute; bottom: 10px; right: 10px;">
                        Download
                    </button>
                    <button onclick="reportPost('${doc.id}')" 
                            style="position: absolute; top: 10px; right: 10px;">
                        Report
                    </button>
                </div>
                <h3>${post.title}</h3>
                <p>${post.description}</p>
            `;
            return div;
        }
        
        // Spam detection
        let spamCount = {};
        
        function detectSpam(userId, content) {
            const key = `${userId}_${content}`;
            spamCount[key] = (spamCount[key] || 0) + 1;
            
            if (spamCount[key] >= 5) {
                showTimeoutScreen();
                // In real implementation, send to Firestore to ban user
            }
        }
        
        function showTimeoutScreen() {
            const timeoutDiv = document.createElement('div');
            timeoutDiv.className = 'timeout-screen';
            timeoutDiv.innerHTML = `
                <div style="text-align: center;">
                    <h1>⏰ TIMED OUT FOR 1 DAY</h1>
                    <p>Reason: Spamming detected</p>
                    <p>Your access will be restored in 24 hours</p>
                </div>
            `;
            document.body.appendChild(timeoutDiv);
        }
        
        // Snow animation
        function createSnow() {
            const snow = document.createElement('div');
            snow.className = 'snow';
            snow.innerHTML = '❄';
            snow.style.left = Math.random() * 100 + 'vw';
            snow.style.fontSize = Math.random() * 20 + 10 + 'px';
            snow.style.opacity = Math.random();
            
            document.body.appendChild(snow);
            
            setTimeout(() => {
                snow.style.top = '100vh';
                snow.style.transform = `translateX(${Math.random() * 100 - 50}px)`;
                snow.style.opacity = '0';
            }, 100);
            
            setTimeout(() => snow.remove(), 5000);
        }
        
        // Create snow every 100ms
        setInterval(createSnow, 100);
    </script>
</body>
</html>
