<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LeakStream</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: monospace;
  background: black;
  color: #00ff00;
}

header {
  position: fixed;
  top: 0;
  width: 100%;
  background: rgba(0,0,0,0.9);
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #00ff00;
  z-index: 1000;
}

header img {
  width: 50px;
  height: 50px;
  animation: spin 6s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

header input {
  margin-left: 20px;
  padding: 5px;
  background: black;
  border: 1px solid #00ff00;
  color: #00ff00;
}

header button {
  margin-left: 10px;
  background: black;
  border: 1px solid #00ff00;
  color: #00ff00;
  padding: 5px 10px;
  cursor: pointer;
}

.container {
  margin-top: 90px;
  padding: 20px;
}

.post {
  border: 1px solid #00ff00;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
}

input, textarea {
  width: 100%;
  background: black;
  color: #00ff00;
  border: 1px solid #00ff00;
  padding: 5px;
  margin-bottom: 10px;
}

a {
  color: #00ff00;
}
</style>
</head>

<body>

<header>
  <img src="https://i.postimg.cc/RhNbssL6/logo.jpg">
  <input id="search" placeholder="search title...">
  <button onclick="goHome()">Home</button>
  <button onclick="goPost()">Post</button>
</header>

<div class="container" id="app"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDlEGndjR_x651X77k0A41mydFo3Emw3So",
  authDomain: "leakstreamnew.firebaseapp.com",
  projectId: "leakstreamnew",
  storageBucket: "leakstreamnew.firebasestorage.app",
  messagingSenderId: "295121939490",
  appId: "1:295121939490:web:d4bd6404d47cb70421ee7b",
  measurementId: "G-Y2LY4BHWD3"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const postsRef = db.ref("posts");

const app = document.getElementById("app");
const search = document.getElementById("search");

function goHome() {
  location.hash = "";
  loadHome();
}

function goPost() {
  location.hash = "post";
  loadPost();
}

function loadHome() {
  app.innerHTML = "";
  postsRef.off();
  postsRef.on("value", snap => {
    app.innerHTML = "";
    const data = snap.val();
    if (!data) return;

    Object.keys(data).reverse().forEach(id => {
      const post = data[id];
      if (post.title.toLowerCase().includes(search.value.toLowerCase())) {
        const div = document.createElement("div");
        div.className = "post";
        div.innerText = post.title;
        div.onclick = () => {
          location.hash = id;
          loadView(id);
        };
        app.appendChild(div);
      }
    });
  });
}

function loadPost() {
  app.innerHTML = `
    <h2>Create Post</h2>
    <input id="title" placeholder="Title">
    <textarea id="desc" placeholder="Description"></textarea>
    <input id="video" placeholder="Video URL (mp4 / embed)">
    <button onclick="publish()">Post</button>

    <h3>Good hosting:</h3>
    <a href="https://imagekit.io/dashboard/media-library" target="_blank">imagekit.io</a><br>
    <a href="https://streamable.com/?utm_source=chatgpt.com" target="_blank">streamable.com</a>
  `;
}

function publish() {
  const title = document.getElementById("title").value.trim();
  const desc = document.getElementById("desc").value.trim();
  const video = document.getElementById("video").value.trim();

  if (!title || !video) return alert("Missing fields");

  postsRef.push({
    title,
    description: desc,
    videoUrl: video,
    timestamp: Date.now()
  });

  goHome();
}

function loadView(id) {
  postsRef.child(id).once("value", snap => {
    const p = snap.val();
    if (!p) return;

    app.innerHTML = `
      <h1>${p.title}</h1>
      <video src="${p.videoUrl}" controls style="width:100%;max-height:400px"></video>
      <p style="margin-top:20px;white-space:pre-wrap">${p.description}</p>
    `;
  });
}

search.addEventListener("input", loadHome);

window.onhashchange = () => {
  if (location.hash === "#post") loadPost();
  else if (location.hash.length > 1) loadView(location.hash.substring(1));
  else loadHome();
};

loadHome();
</script>

</body>
</html>
